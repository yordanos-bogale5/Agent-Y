<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Y</title>
  
  <style>
    body {
      font-family: 'Google Sans', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background-color: #f8f9fa;
      color: #202124;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e8eaed;
    }
    
    .header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 500;
      color: #1a73e8;
    }
    
    .header p {
      margin: 4px 0 0 0;
      font-size: 12px;
      color: #5f6368;
    }
    
    .section {
      margin-bottom: 20px;
      background: white;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .section-title {
      font-weight: 500;
      margin-bottom: 12px;
      color: #202124;
      font-size: 14px;
    }
    
    .quick-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .action-btn {
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .action-btn:hover {
      background: #1557b0;
    }
    
    .action-btn:disabled {
      background: #dadce0;
      color: #5f6368;
      cursor: not-allowed;
    }
    
    .custom-prompt {
      margin-top: 16px;
    }
    
    .input-group {
      margin-bottom: 12px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 4px;
      font-size: 12px;
      color: #5f6368;
      font-weight: 500;
    }
    
    .text-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      min-height: 60px;
      box-sizing: border-box;
    }
    
    .text-input:focus {
      outline: none;
      border-color: #1a73e8;
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }
    
    .primary-btn {
      background: #34a853;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      width: 100%;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .primary-btn:hover {
      background: #2d8f47;
    }
    
    .primary-btn:disabled {
      background: #dadce0;
      color: #5f6368;
      cursor: not-allowed;
    }
    
    .response-area {
      margin-top: 16px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #e8eaed;
      min-height: 100px;
      white-space: pre-wrap;
      font-size: 13px;
      line-height: 1.5;
      display: none;
    }
    
    .response-area.show {
      display: block;
    }
    
    .response-actions {
      margin-top: 8px;
      display: flex;
      gap: 8px;
    }
    
    .secondary-btn {
      background: white;
      color: #1a73e8;
      border: 1px solid #dadce0;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .secondary-btn:hover {
      background: #f8f9fa;
      border-color: #1a73e8;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #5f6368;
    }
    
    .loading.show {
      display: block;
    }
    
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #1a73e8;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: 0 auto 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      background: #fce8e6;
      color: #d93025;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 8px;
      display: none;
    }
    
    .error.show {
      display: block;
    }
    
    .context-info {
      font-size: 11px;
      color: #5f6368;
      margin-bottom: 8px;
      padding: 6px 8px;
      background: #f1f3f4;
      border-radius: 4px;
    }
    
    .settings-link {
      text-align: center;
      margin-top: 16px;
    }
    
    .settings-link a {
      color: #1a73e8;
      text-decoration: none;
      font-size: 12px;
    }
    
    .settings-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Agent Y</h1>
    <p>Intelligent document assistance powered by AI</p>
  </div>

  <div class="section">
    <div class="section-title">Quick Actions</div>
    <div class="quick-actions">
      <button class="action-btn" onclick="handleQuickAction('summarize')">
        üìù Summarize
      </button>
      <button class="action-btn" onclick="handleQuickAction('rewrite')">
        ‚ú® Improve
      </button>
      <button class="action-btn" onclick="handleQuickAction('explain')">
        üí° Explain
      </button>
      <button class="action-btn" onclick="handleQuickAction('generate')">
        üéØ Generate
      </button>
    </div>
    
    <div class="context-info" id="contextInfo">
      Select text or use entire document
    </div>
  </div>

  <div class="section">
    <div class="section-title">Custom Request</div>
    <div class="input-group">
      <label for="customPrompt">What would you like me to help you with?</label>
      <textarea 
        id="customPrompt" 
        class="text-input" 
        placeholder="e.g., Make this more formal, translate to Spanish, add examples..."
        rows="3"
      ></textarea>
    </div>
    <button class="primary-btn" onclick="handleCustomRequest()" id="processBtn">
      Process Request
    </button>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div>Processing your request...</div>
  </div>

  <div class="error" id="error"></div>

  <div class="response-area" id="responseArea">
    <div id="responseText"></div>
    <div class="response-actions">
      <button class="secondary-btn" onclick="insertResponse()">
        Insert into Document
      </button>
      <button class="secondary-btn" onclick="copyResponse()">
        Copy to Clipboard
      </button>
      <button class="secondary-btn" onclick="clearResponse()">
        Clear
      </button>
    </div>
  </div>

  <div class="settings-link">
    <a href="#" onclick="openSettings()">‚öôÔ∏è Settings</a>
  </div>

  <script>
    let currentResponse = '';
    
    // Initialize the interface
    document.addEventListener('DOMContentLoaded', function() {
      updateContextInfo();
      
      // Enable Enter key for custom prompt (Ctrl+Enter to submit)
      document.getElementById('customPrompt').addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
          handleCustomRequest();
        }
      });
    });
    
    /**
     * Handle quick action buttons
     */
    function handleQuickAction(action) {
      showLoading();
      hideError();
      
      google.script.run
        .withSuccessHandler(handleSuccess)
        .withFailureHandler(handleError)
        .processAIRequest(action, '');
    }
    
    /**
     * Handle custom request
     */
    function handleCustomRequest() {
      const prompt = document.getElementById('customPrompt').value.trim();
      
      if (!prompt) {
        showError('Please enter a request');
        return;
      }
      
      showLoading();
      hideError();
      
      google.script.run
        .withSuccessHandler(handleSuccess)
        .withFailureHandler(handleError)
        .processAIRequest('general', prompt);
    }
    
    /**
     * Handle successful AI response
     */
    function handleSuccess(result) {
      hideLoading();
      
      if (result.success) {
        currentResponse = result.result.summary || result.result.rewrittenText || result.result;
        showResponse(currentResponse);
      } else {
        showError(result.error || 'Unknown error occurred');
      }
    }
    
    /**
     * Handle AI request error
     */
    function handleError(error) {
      hideLoading();
      showError(error.message || 'Request failed');
    }
    
    /**
     * Show loading state
     */
    function showLoading() {
      document.getElementById('loading').classList.add('show');
      document.getElementById('processBtn').disabled = true;
      document.querySelectorAll('.action-btn').forEach(btn => btn.disabled = true);
    }
    
    /**
     * Hide loading state
     */
    function hideLoading() {
      document.getElementById('loading').classList.remove('show');
      document.getElementById('processBtn').disabled = false;
      document.querySelectorAll('.action-btn').forEach(btn => btn.disabled = false);
    }
    
    /**
     * Show error message
     */
    function showError(message) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = message;
      errorEl.classList.add('show');
    }
    
    /**
     * Hide error message
     */
    function hideError() {
      document.getElementById('error').classList.remove('show');
    }
    
    /**
     * Show AI response
     */
    function showResponse(text) {
      document.getElementById('responseText').textContent = text;
      document.getElementById('responseArea').classList.add('show');
    }
    
    /**
     * Insert response into document
     */
    function insertResponse() {
      if (!currentResponse) return;
      
      google.script.run
        .withSuccessHandler(() => {
          showSuccess('Text inserted into document');
        })
        .withFailureHandler(handleError)
        .insertTextIntoDocument({text: currentResponse});
    }
    
    /**
     * Copy response to clipboard
     */
    function copyResponse() {
      if (!currentResponse) return;
      
      navigator.clipboard.writeText(currentResponse).then(() => {
        showSuccess('Copied to clipboard');
      }).catch(() => {
        showError('Failed to copy to clipboard');
      });
    }
    
    /**
     * Clear response area
     */
    function clearResponse() {
      document.getElementById('responseArea').classList.remove('show');
      currentResponse = '';
    }
    
    /**
     * Show success message
     */
    function showSuccess(message) {
      // Simple success indication - could be enhanced with a proper notification
      const originalText = document.getElementById('processBtn').textContent;
      document.getElementById('processBtn').textContent = '‚úì ' + message;
      setTimeout(() => {
        document.getElementById('processBtn').textContent = originalText;
      }, 2000);
    }
    
    /**
     * Update context information
     */
    function updateContextInfo() {
      // This would be enhanced to show actual selection info
      document.getElementById('contextInfo').textContent = 
        'Ready to assist with your document';
    }
    
    /**
     * Open settings dialog
     */
    function openSettings() {
      google.script.run.showSettings();
    }
  </script>
</body>
</html>
